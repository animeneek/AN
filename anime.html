<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AnimeNeek - Anime Details</title>
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/animeneek/AnimeNeek/main/assets/favicon-image.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    .section-heading {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      border-bottom: 2px solid #444;
      padding-bottom: 0.25rem;
      font-size: 1.5rem;
    }
    @media (max-width: 768px) {
      .section-heading {
        font-size: 1.25rem;
      }
      .section-heading i {
        font-size: 1.25rem;
      }
    }
    .slider-container {
      padding-left: 1rem;
      padding-right: 1rem;
      overflow-x: auto;
      display: flex;
      gap: 1rem;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
    }
    .slider-container::-webkit-scrollbar {
      display: none;
    }
    .slider-container {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>
</head>
<body class="bg-black text-white min-h-screen flex flex-col">

  <div id="header"></div>

  <main class="flex-grow max-w-[1400px] mx-auto px-4 py-6 space-y-10">

    <!-- Anime Hero -->
    <section id="anime-hero" class="relative rounded-lg overflow-hidden">
      <div id="hero-bg" class="absolute inset-0 bg-black/70"></div>
      <div class="relative z-10 flex flex-col md:flex-row gap-6 p-6">
        <img id="anime-poster" class="w-48 md:w-60 rounded-lg shadow-lg flex-shrink-0" alt="Anime Poster" />
        <div>
          <h1 id="anime-title" class="text-3xl md:text-4xl font-bold text-[#ff4444] mb-2"></h1>
          <p id="anime-genres" class="text-gray-300 text-sm mb-4"></p>
          <p id="anime-info" class="text-gray-400 text-sm mb-6"></p>
          <p id="anime-description" class="text-gray-200 leading-relaxed"></p>
        </div>
      </div>
    </section>

    <!-- Episodes -->
    <section>
      <h2 class="section-heading text-[#ff4444]"><i class="fas fa-list"></i> Episodes</h2>
      <div id="episodes-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mt-4">
        <!-- Episodes will load here -->
      </div>
    </section>

    <!-- Recommendations -->
    <section>
      <h2 class="section-heading text-[#ff4444]"><i class="fas fa-star"></i> Recommended</h2>
      <div id="recommended" class="slider-container mt-4">
        <!-- Recommended anime will load here -->
      </div>
    </section>

  </main>

  <div id="footer"></div>

  <script>
    async function loadPartials() {
      const headerHTML = await fetch("header.html").then(res => res.text());
      document.getElementById("header").innerHTML = headerHTML;

      const footerHTML = await fetch("footer.html").then(res => res.text());
      document.getElementById("footer").innerHTML = footerHTML;

      setupMobileMenuToggle();
      await initAnimePage();
    }

    function setupMobileMenuToggle() {
      const btn = document.getElementById("menu-btn");
      const menu = document.getElementById("mobile-menu");
      if (btn && menu) {
        btn.addEventListener("click", () => {
          menu.classList.toggle("hidden");
        });
      }
    }

    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    function createAnimeCard(anime) {
      const card = document.createElement('a');
      card.href = `anime.html?id=${anime.id}`;
      card.className = 'min-w-[140px] md:min-w-[180px] bg-black/60 rounded-lg overflow-hidden shadow-lg hover:shadow-[#ff4444] transition-shadow duration-300 flex-shrink-0';
      card.innerHTML = `
        <div class="relative aspect-[2/3] w-full overflow-hidden">
          <img src="${anime.coverImage.large}" alt="${anime.title.english || anime.title.romaji}" class="object-cover w-full h-full transition-transform duration-300 hover:scale-105" />
          <div class="absolute bottom-0 w-full bg-gradient-to-t from-black/80 to-transparent p-2">
            <h3 class="text-white text-sm font-semibold truncate">${anime.title.english || anime.title.romaji}</h3>
          </div>
        </div>
      `;
      return card;
    }

    async function initAnimePage() {
      const animeId = getQueryParam('id');
      if (!animeId) {
        document.querySelector('main').innerHTML = '<p class="text-center text-gray-400">No anime selected.</p>';
        return;
      }

      // Fetch Anime Details + Recommendations
      const query = `
        query ($id: Int) {
          Media(id: $id, type: ANIME) {
            id
            title { romaji english }
            genres
            description(asHtml: false)
            coverImage { large extraLarge }
            bannerImage
            averageScore
            seasonYear
            episodes
            recommendations(page: 1, perPage: 10) {
              nodes {
                mediaRecommendation {
                  id
                  title { romaji english }
                  coverImage { large }
                }
              }
            }
          }
        }
      `;
      const res = await fetch('https://graphql.anilist.co', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query, variables: { id: Number(animeId) } })
      });
      const data = await res.json();
      const anime = data.data.Media;

      // Hero Section
      document.getElementById('anime-poster').src = anime.coverImage.large;
      document.getElementById('anime-title').textContent = anime.title.english || anime.title.romaji;
      document.getElementById('anime-genres').textContent = anime.genres.join(', ');
      document.getElementById('anime-info').textContent = `${anime.seasonYear || ''} • ⭐ ${anime.averageScore || 'N/A'}% • ${anime.episodes || '?'} Episodes`;
      document.getElementById('anime-description').innerHTML = anime.description;
      if (anime.bannerImage) {
        document.getElementById('anime-hero').style.backgroundImage = `url(${anime.bannerImage})`;
        document.getElementById('anime-hero').style.backgroundSize = 'cover';
        document.getElementById('anime-hero').style.backgroundPosition = 'center';
      }

      // Episodes List (basic numbering)
      const episodesContainer = document.getElementById('episodes-list');
      if (anime.episodes) {
        for (let i = 1; i <= anime.episodes; i++) {
          const epCard = document.createElement('div');
          epCard.className = 'bg-black/60 p-3 rounded-lg text-center hover:bg-[#ff4444]/20 cursor-pointer transition';
          epCard.textContent = `Episode ${i}`;
          episodesContainer.appendChild(epCard);
        }
      } else {
        episodesContainer.innerHTML = `<p class="text-gray-400 italic">No episodes found.</p>`;
      }

      // Recommended Anime
      const recContainer = document.getElementById('recommended');
      anime.recommendations.nodes.forEach(rec => {
        if (rec.mediaRecommendation) {
          recContainer.appendChild(createAnimeCard(rec.mediaRecommendation));
        }
      });
    }

    loadPartials();
  </script>

</body>
</html>

<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AnimeNeek - Anime Details</title>
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/animeneek/AnimeNeek/main/assets/favicon-image.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    .section-heading {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      border-bottom: 2px solid #444;
      padding-bottom: 0.25rem;
      font-size: 1.5rem;
    }
    @media (max-width: 768px) {
      .section-heading { font-size: 1.25rem; }
      .section-heading i { font-size: 1.25rem; }
    }
    .slider-container {
      padding-left: 1rem;
      padding-right: 1rem;
      overflow-x: auto;
      display: flex;
      gap: 1rem;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
    }
    .slider-container::-webkit-scrollbar { display: none; }
    .slider-container { -ms-overflow-style: none; scrollbar-width: none; }
    .poster-fixed {
      aspect-ratio: 2/3;
      object-fit: cover;
    }
  </style>
</head>
<body class="bg-black text-white min-h-screen flex flex-col">

  <div id="header"></div>

  <main class="flex-grow max-w-[1400px] mx-auto px-4 py-6 space-y-10">

    <!-- Anime Hero -->
    <section id="anime-hero" class="relative rounded-lg overflow-hidden">
      <div id="hero-bg" class="absolute inset-0 bg-black/70"></div>
      <div class="relative z-10 flex flex-col md:flex-row gap-6 p-6">
        <img id="anime-poster" class="w-48 md:w-60 rounded-lg shadow-lg flex-shrink-0 poster-fixed" alt="Anime Poster" />
        <div>
          <h1 id="anime-title" class="text-3xl md:text-4xl font-bold text-[#ff4444] mb-2"></h1>
          <p id="anime-genres" class="text-gray-300 text-sm mb-4"></p>
          <p id="anime-info" class="text-gray-400 text-sm mb-6"></p>
          <p id="anime-description" class="text-gray-200 leading-relaxed"></p>
        </div>
      </div>
    </section>

    <!-- Overview -->
    <section>
      <h2 class="section-heading text-[#ff4444]"><i class="fas fa-circle-info"></i> Overview</h2>
      <div id="anime-overview" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mt-4 text-gray-300 text-sm">
        <!-- Overview data here -->
      </div>
    </section>

    <!-- Episodes -->
    <section>
      <h2 class="section-heading text-[#ff4444]"><i class="fas fa-list"></i> Episodes</h2>
      <div id="episodes-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mt-4">
        <!-- Episodes will load here -->
      </div>
    </section>

    <!-- Relations -->
    <section>
      <h2 class="section-heading text-[#ff4444]"><i class="fas fa-link"></i> Relations</h2>
      <div id="relations" class="slider-container mt-4"></div>
    </section>

    <!-- Main Characters -->
    <section>
      <h2 class="section-heading text-[#ff4444]"><i class="fas fa-users"></i> Main Characters</h2>
      <div id="characters" class="slider-container mt-4"></div>
    </section>

    <!-- Recommendations -->
    <section>
      <h2 class="section-heading text-[#ff4444]"><i class="fas fa-star"></i> Recommended</h2>
      <div id="recommended" class="slider-container mt-4"></div>
    </section>

  </main>

  <div id="footer"></div>

  <script>
    async function loadPartials() {
      const headerHTML = await fetch("header.html").then(res => res.text());
      document.getElementById("header").innerHTML = headerHTML;

      const footerHTML = await fetch("footer.html").then(res => res.text());
      document.getElementById("footer").innerHTML = footerHTML;

      setupMobileMenuToggle();
      await initAnimePage();
    }

    function setupMobileMenuToggle() {
      const btn = document.getElementById("menu-btn");
      const menu = document.getElementById("mobile-menu");
      if (btn && menu) {
        btn.addEventListener("click", () => menu.classList.toggle("hidden"));
      }
    }

    function getQueryParam(name) {
      return new URLSearchParams(window.location.search).get(name);
    }

    function createAnimeCard(anime) {
      const card = document.createElement('a');
      card.href = `anime.html?id=${anime.id}`;
      card.className = 'min-w-[140px] md:min-w-[180px] bg-black/60 rounded-lg overflow-hidden shadow-lg hover:shadow-[#ff4444] transition-shadow duration-300 flex-shrink-0';
      card.innerHTML = `
        <div class="relative aspect-[2/3] w-full overflow-hidden">
          <img src="${anime.coverImage.large}" alt="${anime.title.english || anime.title.romaji}" class="object-cover w-full h-full transition-transform duration-300 hover:scale-105" />
          <div class="absolute bottom-0 w-full bg-gradient-to-t from-black/80 to-transparent p-2">
            <h3 class="text-white text-sm font-semibold truncate">${anime.title.english || anime.title.romaji}</h3>
          </div>
        </div>
      `;
      return card;
    }

    async function initAnimePage() {
      const animeId = getQueryParam('id');
      if (!animeId) {
        document.querySelector('main').innerHTML = '<p class="text-center text-gray-400">No anime selected.</p>';
        return;
      }

      const query = `
        query ($id: Int) {
          Media(id: $id, type: ANIME) {
            id
            title { romaji english }
            genres
            description(asHtml: false)
            coverImage { large extraLarge }
            bannerImage
            averageScore
            seasonYear
            episodes
            duration
            relations { edges { node { id title { romaji english } coverImage { large } type } } }
            characters(role: MAIN, page: 1, perPage: 10) {
              edges { node { name { full } image { large } } }
            }
            recommendations(page: 1, perPage: 10) {
              nodes { mediaRecommendation { id title { romaji english } coverImage { large } } }
            }
          }
        }
      `;
      const res = await fetch('https://graphql.anilist.co', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query, variables: { id: Number(animeId) } })
      });
      const data = await res.json();
      const anime = data.data.Media;

      document.getElementById('anime-poster').src = anime.coverImage.large;
      document.getElementById('anime-title').textContent = anime.title.english || anime.title.romaji;
      document.getElementById('anime-genres').textContent = anime.genres.join(', ');
      document.getElementById('anime-info').textContent = `${anime.seasonYear || ''} • ⭐ ${anime.averageScore || 'N/A'}% • ${anime.episodes || '?'} Episodes`;
      document.getElementById('anime-description').innerHTML = anime.description.replace(/<br><br>/g, ' ');
      if (anime.bannerImage) {
        document.getElementById('anime-hero').style.backgroundImage = `url(${anime.bannerImage})`;
        document.getElementById('anime-hero').style.backgroundSize = 'cover';
        document.getElementById('anime-hero').style.backgroundPosition = 'center';
      }

      // Overview
      const overview = document.getElementById('anime-overview');
      overview.innerHTML = `
        <div><strong>Year:</strong> ${anime.seasonYear || 'N/A'}</div>
        <div><strong>Rating:</strong> ${anime.averageScore || 'N/A'}%</div>
        <div><strong>Episodes:</strong> ${anime.episodes || '?'}</div>
        <div><strong>Duration:</strong> ${anime.duration || '?'} min</div>
      `;

      // Episodes from JSON
      const episodesContainer = document.getElementById('episodes-list');
      try {
        const eps = await fetch("https://raw.githubusercontent.com/animeneek/AN/main/episodes.json").then(r => r.json());
        if (eps[animeId]) {
          eps[animeId].forEach(ep => {
            const epCard = document.createElement('div');
            epCard.className = 'bg-black/60 p-3 rounded-lg text-center hover:bg-[#ff4444]/20 cursor-pointer transition';
            epCard.textContent = `EP ${ep.number}`;
            episodesContainer.appendChild(epCard);
          });
        } else {
          episodesContainer.innerHTML = `<p class="text-gray-400 italic">No episodes found.</p>`;
        }
      } catch (e) {
        episodesContainer.innerHTML = `<p class="text-gray-400 italic">Error loading episodes.</p>`;
      }

      // Relations
      const relContainer = document.getElementById('relations');
      anime.relations.edges.forEach(rel => {
        relContainer.appendChild(createAnimeCard(rel.node));
      });

      // Characters
      const charContainer = document.getElementById('characters');
      anime.characters.edges.forEach(ch => {
        const card = document.createElement('div');
        card.className = 'min-w-[140px] text-center';
        card.innerHTML = `
          <img src="${ch.node.image.large}" class="w-full aspect-[2/3] object-cover rounded-lg mb-2" />
          <p class="text-sm">${ch.node.name.full}</p>
        `;
        charContainer.appendChild(card);
      });

      // Recommended
      const recContainer = document.getElementById('recommended');
      anime.recommendations.nodes.forEach(rec => {
        if (rec.mediaRecommendation) {
          recContainer.appendChild(createAnimeCard(rec.mediaRecommendation));
        }
      });
    }

    loadPartials();
  </script>
</body>
</html>
